<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>可排序的右侧浮动按钮组</title>
  <!-- 外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#4F46E5', // 主色调：靛蓝色
            secondary: '#10B981', // 辅助色：绿色
            accent: '#F59E0B', // 强调色：琥珀色
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .btn-float {
        @apply w-12 h-12 rounded-full flex items-center justify-center shadow-lg 
               text-white cursor-pointer transition-all duration-300 
               hover:scale-110 hover:shadow-xl active:scale-95 relative overflow-hidden;
      }
      .btn-float::before {
        content: '';
        @apply absolute inset-0 bg-white opacity-0 transition-opacity duration-300;
      }
      .btn-float:hover::before {
        @apply opacity-10;
      }
      .divider-line {
        @apply w-8 h-0.5 bg-gray-400 dark:bg-gray-600 my-2 mx-auto transition-all duration-300;
      }
      .tooltip {
        @apply absolute right-full mr-3 whitespace-nowrap bg-gray-800 dark:bg-gray-200 
               text-white dark:text-gray-800 text-xs py-1 px-2 rounded shadow-md 
               opacity-0 invisible transition-all duration-300 pointer-events-none;
      }
      .btn-float:hover .tooltip {
        @apply opacity-100 visible mr-4;
      }
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300 min-h-screen">
  <!-- 主内容区，用于演示页面滚动 -->
  <div class="container mx-auto px-4 py-16 max-w-4xl">
    <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-gray-800 dark:text-white mb-6">可排序的右侧浮动按钮组</h1>
    <p class="text-gray-600 dark:text-gray-300 text-lg mb-8">
      这是一个功能完整的右侧浮动按钮组演示。您可以：
    </p>
    <ul class="list-disc pl-6 text-gray-600 dark:text-gray-300 mb-10 space-y-2">
      <li>点击展开按钮查看所有功能按钮</li>
      <li>拖动按钮自定义排序（前5个默认显示）</li>
      <li>排序会自动保存到本地存储</li>
      <li>体验每个按钮的实用功能</li>
    </ul>
    
    <!-- 占位内容，使页面有足够高度 -->
    <div class="space-y-8 mb-20">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 h-64 flex items-center justify-center transform transition-all hover:shadow-lg">
        <p class="text-gray-500 dark:text-gray-400">内容区块 1</p>
      </div>
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 h-64 flex items-center justify-center transform transition-all hover:shadow-lg">
        <p class="text-gray-500 dark:text-gray-400">内容区块 2</p>
      </div>
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 h-64 flex items-center justify-center transform transition-all hover:shadow-lg">
        <p class="text-gray-500 dark:text-gray-400">内容区块 3</p>
      </div>
    </div>
  </div>
  
  <!-- 右侧浮动按钮组容器 -->
  <div id="float-buttons-container" class="fixed right-6 top-1/2 -translate-y-1/2 z-50 flex flex-col items-center gap-3 select-none">
    <!-- 可见按钮区域 -->
    <div id="visible-buttons" class="flex flex-col items-center gap-3"></div>
    
    <!-- 分界线 -->
    <div id="divider" class="divider-line opacity-0"></div>
    
    <!-- 隐藏按钮区域 -->
    <div id="hidden-buttons" class="flex flex-col items-center gap-3 hidden"></div>
    
    <!-- 展开/收起按钮 -->
    <button id="toggle-button" class="btn-float bg-accent group">
      <i class="fa fa-chevron-down transition-transform duration-300 group-hover:rotate-180" id="toggle-icon"></i>
      <span class="tooltip">展开/收起</span>
    </button>
  </div>
  
  <!-- 搜索模态框 -->
  <div id="search-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center opacity-0 invisible transition-all duration-300">
    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 w-full max-w-md transform translate-y-8 transition-all duration-300">
      <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
        <i class="fa fa-search text-primary mr-2"></i>搜索
      </h3>
      <input type="text" placeholder="输入搜索内容..." class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white mb-4 focus:outline-none focus:ring-2 focus:ring-primary/50">
      <div class="flex justify-end">
        <button id="close-search" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">关闭</button>
      </div>
    </div>
  </div>
  
  <script>
    // 按钮数据定义
    const defaultButtons = [
      { id: 'top', icon: 'fa-arrow-up', tooltip: '返回顶部', color: 'bg-primary' },
      { id: 'favorite', icon: 'fa-star-o', tooltip: '收藏', color: 'bg-secondary' },
      { id: 'share', icon: 'fa-share-alt', tooltip: '分享', color: 'bg-primary' },
      { id: 'search', icon: 'fa-search', tooltip: '搜索', color: 'bg-secondary' },
      { id: 'print', icon: 'fa-print', tooltip: '打印', color: 'bg-primary' },
      { id: 'home', icon: 'fa-home', tooltip: '返回主页', color: 'bg-secondary' },
      { id: 'theme', icon: 'fa-moon-o', tooltip: '昼夜切换', color: 'bg-primary' },
      { id: 'refresh', icon: 'fa-refresh', tooltip: '刷新页面', color: 'bg-secondary' },
      { id: 'fullscreen', icon: 'fa-expand', tooltip: '全屏', color: 'bg-primary' },
      { id: 'history', icon: 'fa-history', tooltip: '历史记录', color: 'bg-secondary' },
      { id: 'settings', icon: 'fa-cog', tooltip: '设置', color: 'bg-primary' },
      { id: 'help', icon: 'fa-question-circle', tooltip: '帮助', color: 'bg-secondary' }
    ];
    
    // 从本地存储获取按钮配置
    function getButtonsFromStorage() {
      const stored = localStorage.getItem('floatButtons');
      return stored ? JSON.parse(stored) : defaultButtons;
    }
    
    // 保存按钮配置到本地存储
    function saveButtonsToStorage(buttons) {
      localStorage.setItem('floatButtons', JSON.stringify(buttons));
    }
    
    // 渲染按钮
    function renderButtons() {
      const buttons = getButtonsFromStorage();
      const visibleContainer = document.getElementById('visible-buttons');
      const hiddenContainer = document.getElementById('hidden-buttons');
      
      // 清空容器
      visibleContainer.innerHTML = '';
      hiddenContainer.innerHTML = '';
      
      // 默认显示前5个按钮
      const visibleButtons = buttons.slice(0, 5);
      const hiddenButtons = buttons.slice(5);
      
      // 渲染可见按钮
      visibleButtons.forEach(button => {
        const btn = createButtonElement(button);
        visibleContainer.appendChild(btn);
      });
      
      // 渲染隐藏按钮
      hiddenButtons.forEach(button => {
        const btn = createButtonElement(button);
        hiddenContainer.appendChild(btn);
      });
      
      // 初始化拖拽排序
      initSortable();
      
      // 更新主题按钮图标
      updateThemeIcon();
    }
    
    // 创建按钮元素
    function createButtonElement(button) {
      const btn = document.createElement('button');
      btn.id = button.id;
      btn.className = `btn-float ${button.color}`;
      btn.setAttribute('data-id', button.id);
      
      const icon = document.createElement('i');
      icon.className = `fa ${button.icon} transition-transform duration-300`;
      
      // 添加tooltip
      const tooltip = document.createElement('span');
      tooltip.className = 'tooltip';
      tooltip.textContent = button.tooltip;
      
      btn.appendChild(icon);
      btn.appendChild(tooltip);
      
      // 添加按钮点击事件
      btn.addEventListener('click', (e) => {
        // 防止点击事件干扰拖拽
        if (!isDragging) {
          handleButtonClick(button.id);
        }
      });
      
      return btn;
    }
    
    // 按钮点击事件处理
    function handleButtonClick(buttonId) {
      switch(buttonId) {
        case 'top':
          // 平滑滚动到顶部
          window.scrollTo({ top: 0, behavior: 'smooth' });
          break;
        case 'favorite':
          // 收藏功能
          const btn = document.getElementById('favorite');
          const icon = btn.querySelector('i');
          if (icon.classList.contains('fa-star-o')) {
            icon.classList.replace('fa-star-o', 'fa-star');
            showToast('已添加到收藏');
          } else {
            icon.classList.replace('fa-star', 'fa-star-o');
            showToast('已取消收藏');
          }
          break;
        case 'share':
          // 分享功能
          if (navigator.share) {
            navigator.share({
              title: document.title,
              url: window.location.href
            }).then(() => {
              showToast('分享成功');
            }).catch(err => {
              console.log('分享失败:', err);
              showToast('分享功能不可用');
            });
          } else {
            showToast('您的浏览器不支持分享功能');
          }
          break;
        case 'search':
          // 搜索功能
          const modal = document.getElementById('search-modal');
          modal.classList.remove('opacity-0', 'invisible');
          modal.querySelector('div').classList.remove('translate-y-8');
          modal.querySelector('input').focus();
          break;
        case 'print':
          // 打印功能
          window.print();
          break;
        case 'home':
          // 返回主页
          if (confirm('确定要返回主页吗？')) {
            window.location.href = '#';
          }
          break;
        case 'theme':
          // 昼夜切换
          document.documentElement.classList.toggle('dark');
          localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
          updateThemeIcon();
          showToast(document.documentElement.classList.contains('dark') ? '已切换到深色模式' : '已切换到浅色模式');
          break;
        case 'refresh':
          // 刷新页面
          window.location.reload();
          break;
        case 'fullscreen':
          // 全屏切换
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().then(() => {
              showToast('已进入全屏模式');
            }).catch(err => {
              showToast(`全屏请求失败: ${err.message}`);
            });
          } else {
            if (document.exitFullscreen) {
              document.exitFullscreen();
              showToast('已退出全屏模式');
            }
          }
          break;
        case 'history':
          // 历史记录
          if (history.length > 1) {
            if (confirm('是否要查看浏览历史？')) {
              showToast('在实际应用中会打开历史记录');
            }
          } else {
            showToast('没有浏览历史');
          }
          break;
        case 'settings':
          // 设置
          showToast('在实际应用中会打开设置面板');
          break;
        case 'help':
          // 帮助
          alert('帮助信息：\n- 拖动按钮可以调整顺序\n- 前5个按钮默认显示\n- 点击展开按钮可以查看所有按钮\n- 排序会自动保存');
          break;
      }
    }
    
    // 显示提示消息
    function showToast(message) {
      // 检查是否已有toast，有则移除
      const existingToast = document.querySelector('.toast-notification');
      if (existingToast) {
        existingToast.remove();
      }
      
      // 创建toast元素
      const toast = document.createElement('div');
      toast.className = 'toast-notification fixed bottom-6 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-y-10 opacity-0';
      toast.textContent = message;
      
      // 添加到页面
      document.body.appendChild(toast);
      
      // 显示toast
      setTimeout(() => {
        toast.classList.remove('translate-y-10', 'opacity-0');
      }, 10);
      
      // 3秒后隐藏
      setTimeout(() => {
        toast.classList.add('translate-y-10', 'opacity-0');
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, 3000);
    }
    
    // 更新主题按钮图标
    function updateThemeIcon() {
      const themeBtn = document.getElementById('theme');
      if (themeBtn) {
        const icon = themeBtn.querySelector('i');
        if (document.documentElement.classList.contains('dark')) {
          icon.className = 'fa fa-sun-o transition-transform duration-300';
        } else {
          icon.className = 'fa fa-moon-o transition-transform duration-300';
        }
      }
    }
    
    let isDragging = false;
    
    // 初始化拖拽排序
    function initSortable() {
      const container = document.getElementById('float-buttons-container');
      const divider = document.getElementById('divider');
      
      // 初始化Sortable
      const sortable = new Sortable(container, {
        animation: 150,
        handle: 'button:not(#toggle-button)',
        draggable: 'button:not(#toggle-button)',
        ghostClass: 'opacity-50 scale-90',
        chosenClass: 'ring-2 ring-white',
        onStart: () => {
          // 拖动开始时显示分界线
          divider.style.opacity = '1';
          isDragging = true;
        },
        onEnd: () => {
          // 拖动结束时隐藏分界线
          divider.style.opacity = '0';
          isDragging = false;
          
          // 更新按钮顺序并保存到本地存储
          updateButtonOrder();
        },
        onMove: (evt) => {
          // 确保分界线位置正确
          const visibleCount = 5;
          const allElements = Array.from(container.children);
          const visibleButtons = allElements.filter(el => el.id === 'visible-buttons' ? 
            Array.from(el.children) : el.tagName === 'BUTTON' && el.id !== 'toggle-button');
          
          // 限制拖动范围，确保前5个始终在可见区域
          const draggedIndex = allElements.indexOf(evt.dragged);
          const relatedIndex = allElements.indexOf(evt.related);
          
          // 防止前5个按钮被拖到后面，后7个按钮被拖到前面
          if (draggedIndex < visibleCount && relatedIndex >= visibleCount) {
            return false;
          }
          if (draggedIndex >= visibleCount && relatedIndex < visibleCount) {
            return false;
          }
        }
      });
    }
    
    // 更新按钮顺序
    function updateButtonOrder() {
      const container = document.getElementById('float-buttons-container');
      // 获取所有按钮（排除展开/收起按钮）
      const buttons = Array.from(container.querySelectorAll('button:not(#toggle-button)'));
      const buttonIds = buttons.map(btn => btn.getAttribute('data-id'));
      
      // 更新按钮顺序
      const allButtons = getButtonsFromStorage();
      const newOrder = buttonIds.map(id => allButtons.find(btn => btn.id === id));
      
      // 保存新顺序
      saveButtonsToStorage(newOrder);
      
      // 重新渲染按钮
      renderButtons();
      
      showToast('排序已保存');
    }
    
    // 切换按钮展开/收起状态
    function toggleButtons() {
      const hiddenContainer = document.getElementById('hidden-buttons');
      const toggleIcon = document.getElementById('toggle-icon');
      const divider = document.getElementById('divider');
      
      hiddenContainer.classList.toggle('hidden');
      
      if (hiddenContainer.classList.contains('hidden')) {
        toggleIcon.className = 'fa fa-chevron-down transition-transform duration-300 group-hover:rotate-180';
        divider.style.opacity = '0';
      } else {
        toggleIcon.className = 'fa fa-chevron-up transition-transform duration-300 group-hover:rotate-180';
        divider.style.opacity = '1';
      }
    }
    
    // 初始化页面
    function init() {
      // 检查深色模式偏好
      if (localStorage.getItem('darkMode') === 'true' || 
          (window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('darkMode'))) {
        document.documentElement.classList.add('dark');
      }
      
      // 渲染按钮
      renderButtons();
      
      // 添加展开/收起按钮事件
      document.getElementById('toggle-button').addEventListener('click', toggleButtons);
      
      // 添加搜索模态框关闭事件
      document.getElementById('close-search').addEventListener('click', () => {
        closeSearchModal();
      });
      
      // 点击模态框外部关闭
      document.getElementById('search-modal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('search-modal')) {
          closeSearchModal();
        }
      });
      
      // ESC键关闭搜索模态框
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !document.getElementById('search-modal').classList.contains('invisible')) {
          closeSearchModal();
        }
      });
    }
    
    // 关闭搜索模态框
    function closeSearchModal() {
      const modal = document.getElementById('search-modal');
      modal.classList.add('opacity-0', 'invisible');
      modal.querySelector('div').classList.add('translate-y-8');
    }
    
    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
