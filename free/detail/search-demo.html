<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>搜索框演示</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1677ff',
                        secondary: '#f0f2f5',
                        neutral: '#8c8c8c',
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .search-shadow {
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .result-item-hover {
                @apply bg-secondary transition-colors duration-200;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-md">
        <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-gray-800 mb-6 text-center">搜索演示</h1>
        
        <!-- 搜索容器 -->
        <div class="relative">
            <!-- 搜索框 -->
            <div class="relative">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="输入关键词搜索..." 
                    class="w-full py-3 px-4 pr-10 rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all duration-200 search-shadow"
                >
                <button id="clearBtn" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-neutral opacity-0 transition-opacity duration-200">
                    <i class="fa fa-times-circle text-lg"></i>
                </button>
                <button id="searchBtn" class="absolute right-10 top-1/2 transform -translate-y-1/2 text-primary">
                    <i class="fa fa-search text-lg"></i>
                </button>
            </div>
            
            <!-- 搜索结果容器 - 初始隐藏 -->
            <div id="searchResults" class="absolute left-0 right-0 mt-1 bg-white rounded-lg shadow-lg overflow-hidden z-50 max-h-80 overflow-y-auto hidden">
                <!-- 加载状态 - 初始隐藏 -->
                <div id="loadingIndicator" class="p-4 flex items-center justify-center hidden">
                    <i class="fa fa-spinner fa-spin text-primary mr-2"></i>
                    <span class="text-gray-600">搜索中...</span>
                </div>
                
                <!-- 无结果状态 - 初始隐藏 -->
                <div id="noResults" class="p-4 text-center text-gray-500 hidden">
                    <i class="fa fa-search-minus text-2xl mb-2 block"></i>
                    <span>没有找到匹配的结果</span>
                </div>
                
                <!-- 结果列表 -->
                <ul id="resultsList" class="divide-y divide-gray-100">
                    <!-- 结果将通过JS动态插入 -->
                </ul>
            </div>
        </div>
        
        <div class="mt-8 text-center text-sm text-gray-500">
            <p>尝试搜索: 微信、小程序、支付、朋友圈、公众号</p>
        </div>
    </div>

    <script>
        // 测试数据 - 模拟搜索内容
        const testData = [
            { id: 1, title: "微信支付安全指南", category: "支付", description: "了解如何保障微信支付安全，防范诈骗风险" },
            { id: 2, title: "微信小程序开发教程", category: "小程序", description: "从零开始学习微信小程序开发，掌握基本技能" },
            { id: 3, title: "微信朋友圈使用技巧", category: "朋友圈", description: "10个实用的微信朋友圈小技巧，提升使用体验" },
            { id: 4, title: "微信公众号运营策略", category: "公众号", description: "有效的微信公众号运营方法，提高粉丝活跃度" },
            { id: 5, title: "微信隐私设置详解", category: "微信", description: "全面了解微信隐私设置，保护个人信息安全" },
            { id: 6, title: "微信转账限额说明", category: "支付", description: "2023年微信转账和红包限额最新规定" },
            { id: 7, title: "微信小程序审核规范", category: "小程序", description: "微信小程序提交审核必须遵守的规范要求" },
            { id: 8, title: "微信朋友圈广告投放", category: "朋友圈", description: "如何在微信朋友圈投放精准广告" },
            { id: 9, title: "微信公众号认证流程", category: "公众号", description: "微信公众号个人和企业认证的详细步骤" },
            { id: 10, title: "微信多账号登录技巧", category: "微信", description: "如何在同一设备上管理多个微信账号" }
        ];

        // DOM元素
        const searchInput = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearBtn');
        const searchBtn = document.getElementById('searchBtn');
        const searchResults = document.getElementById('searchResults');
        const resultsList = document.getElementById('resultsList');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const noResults = document.getElementById('noResults');

        // 监听输入事件
        searchInput.addEventListener('input', handleInput);
        // 监听清除按钮点击
        clearBtn.addEventListener('click', clearSearch);
        // 监听搜索按钮点击
        searchBtn.addEventListener('click', performSearch);
        // 监听键盘事件
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // 点击页面其他地方关闭搜索结果
        document.addEventListener('click', (e) => {
            const isClickInside = searchInput.contains(e.target) || 
                                 searchResults.contains(e.target) ||
                                 searchBtn.contains(e.target);
            
            if (!isClickInside) {
                searchResults.classList.add('hidden');
            }
        });

        // 处理输入事件
        function handleInput() {
            const value = searchInput.value.trim();
            
            // 显示或隐藏清除按钮
            if (value) {
                clearBtn.classList.remove('opacity-0');
                clearBtn.classList.add('opacity-100');
            } else {
                clearBtn.classList.remove('opacity-100');
                clearBtn.classList.add('opacity-0');
                searchResults.classList.add('hidden');
            }
            
            // 输入内容足够时自动搜索
            if (value.length >= 1) {
                performSearch();
            }
        }

        // 清除搜索内容
        function clearSearch() {
            searchInput.value = '';
            clearBtn.classList.remove('opacity-100');
            clearBtn.classList.add('opacity-0');
            searchResults.classList.add('hidden');
            searchInput.focus();
        }

        // 执行搜索
        function performSearch() {
            const query = searchInput.value.trim().toLowerCase();
            
            if (!query) {
                return;
            }
            
            // 显示搜索结果容器和加载状态
            searchResults.classList.remove('hidden');
            resultsList.classList.add('hidden');
            noResults.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            
            // 模拟网络延迟
            setTimeout(() => {
                // 过滤结果
                const filteredResults = testData.filter(item => 
                    item.title.toLowerCase().includes(query) || 
                    item.category.toLowerCase().includes(query) ||
                    item.description.toLowerCase().includes(query)
                );
                
                // 更新UI
                loadingIndicator.classList.add('hidden');
                
                if (filteredResults.length > 0) {
                    displayResults(filteredResults, query);
                    resultsList.classList.remove('hidden');
                    noResults.classList.add('hidden');
                } else {
                    resultsList.classList.add('hidden');
                    noResults.classList.remove('hidden');
                }
            }, 300); // 模拟300ms网络延迟
        }

        // 显示搜索结果
        function displayResults(results, query) {
            resultsList.innerHTML = '';
            
            results.forEach(item => {
                const li = document.createElement('li');
                li.className = 'p-3 hover:result-item-hover cursor-pointer';
                
                // 高亮匹配的文本
                const highlightedTitle = highlightMatch(item.title, query);
                const highlightedCategory = highlightMatch(item.category, query);
                const highlightedDesc = highlightMatch(item.description, query);
                
                li.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium text-gray-800">${highlightedTitle}</h3>
                            <p class="text-xs text-neutral mt-1">${highlightedDesc}</p>
                        </div>
                        <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">${highlightedCategory}</span>
                    </div>
                `;
                
                // 点击结果项的处理
                li.addEventListener('click', () => {
                    // 在实际应用中，这里可以跳转到对应的详情页
                    alert(`您选择了: ${item.title}`);
                    searchResults.classList.add('hidden');
                });
                
                resultsList.appendChild(li);
            });
        }

        // 高亮匹配的文本
        function highlightMatch(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="text-primary font-medium">$1</span>');
        }

        // 微信浏览器特殊处理 - 防止橡皮筋效果影响体验
        document.body.addEventListener('touchmove', (e) => {
            // 仅在搜索结果显示时阻止页面滚动
            if (!searchResults.classList.contains('hidden')) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
