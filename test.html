<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dev Tools Library</title>
  <!-- 引入Tailwind CSS用于样式 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome用于图标 -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 自定义Tailwind配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFFB',
            dark: '#1D2129',
            light: '#F2F3F5'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .tag-active {
        @apply bg-primary text-white border-primary;
      }
      .tool-card {
        @apply bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-300;
      }
      .tag-item {
        @apply px-3 py-1 rounded-full text-sm border cursor-pointer transition-all duration-200 hover:bg-primary/10;
      }
    }
  </style>
</head>
<body class="font-inter bg-light text-dark min-h-screen">
  <!-- 页面头部 -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
      <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-primary mb-4 md:mb-0">
        <i class="fa fa-code mr-2"></i>Dev Tools Library
      </h1>
      <div class="flex items-center space-x-2">
        <span id="tool-count" class="bg-primary/10 text-primary px-3 py-1 rounded-full text-sm">
          Total Tools: <span class="font-bold">0</span>
        </span>
        <button id="reset-filter" class="bg-white border border-primary text-primary px-3 py-1 rounded-full text-sm hover:bg-primary/5 transition-colors duration-200 hidden">
          <i class="fa fa-refresh mr-1"></i>Reset
        </button>
      </div>
    </div>
  </header>

  <!-- 主要内容区 -->
  <main class="container mx-auto px-4 py-8">
    <!-- 标签分类区域 -->
    <section class="mb-10">
      <h2 class="text-[clamp(1.2rem,2vw,1.8rem)] font-semibold mb-4 flex items-center">
        <i class="fa fa-tags text-primary mr-2"></i>Filter by Tags
      </h2>
      
      <!-- 标签分类容器（按首字母分组） -->
      <div id="tag-categories" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- 标签分类会通过JS动态生成 -->
      </div>
    </section>

    <!-- 工具列表区域 -->
    <section>
      <h2 class="text-[clamp(1.2rem,2vw,1.8rem)] font-semibold mb-4 flex items-center">
        <i class="fa fa-th-large text-primary mr-2"></i>Tool List
      </h2>
      
      <!-- 工具列表容器 -->
      <div id="tool-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <!-- 工具卡片会通过JS动态生成 -->
        <div class="col-span-full text-center py-10 text-gray-500">
          <i class="fa fa-spinner fa-spin text-3xl mb-4"></i>
          <p>Loading tools...</p>
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="bg-dark text-white py-8 mt-12">
    <div class="container mx-auto px-4 text-center">
      <p class="mb-2">Dev Tools Library &copy; 2024</p>
      <p class="text-gray-400 text-sm">Click on tool names to view details</p>
    </div>
  </footer>

  <!-- JavaScript 逻辑 -->
  <script>
    // 全局变量存储工具数据和标签数据
    let toolsData = [];
    let allTags = new Set(); // 存储去重后的所有标签
    let activeTag = null; // 当前激活的标签

    // DOM 元素
    const tagCategoriesEl = document.getElementById('tag-categories');
    const toolListEl = document.getElementById('tool-list');
    const toolCountEl = document.getElementById('tool-count').querySelector('span');
    const resetFilterBtn = document.getElementById('reset-filter');

    // 初始化函数
    async function init() {
      try {
        // 1. 加载JSON数据
        const response = await fetch('tools.json');
        if (!response.ok) throw new Error('Failed to load tools data');
        toolsData = await response.json();

        // 2. 处理数据（提取所有标签、更新工具数量）
        processToolData();

        // 3. 生成标签分类
        renderTagCategories();

        // 4. 生成工具列表（默认显示全部）
        renderToolList();

      } catch (error) {
        toolListEl.innerHTML = `
          <div class="col-span-full text-center py-10 text-red-500">
            <i class="fa fa-exclamation-circle text-3xl mb-4"></i>
            <p>Error: ${error.message}</p>
          </div>
        `;
        console.error('Initialization error:', error);
      }
    }

    // 处理工具数据：提取所有标签、更新工具数量
    function processToolData() {
      // 提取所有标签（去重）
      toolsData.forEach(tool => {
        tool.tags.forEach(tag => allTags.add(tag));
      });

      // 更新工具总数
      toolCountEl.textContent = toolsData.length;
    }

    // 生成标签分类（按首字母分组）
    function renderTagCategories() {
      // 1. 标签按首字母分组
      const tagsByLetter = {};
      Array.from(allTags).sort().forEach(tag => {
        const firstLetter = tag[0].toUpperCase();
        if (!tagsByLetter[firstLetter]) {
          tagsByLetter[firstLetter] = [];
        }
        tagsByLetter[firstLetter].push(tag);
      });

      // 2. 生成HTML
      let html = '';
      Object.keys(tagsByLetter).sort().forEach(letter => {
        html += `
          <div class="bg-white rounded-lg shadow-sm p-5">
            <h3 class="font-bold text-lg mb-3 text-primary">${letter}</h3>
            <div class="flex flex-wrap gap-2">
              ${tagsByLetter[letter].map(tag => `
                <span class="tag-item ${activeTag === tag ? 'tag-active' : ''}" 
                      data-tag="${tag}">
                  ${tag}
                </span>
              `).join('')}
            </div>
          </div>
        `;
      });

      tagCategoriesEl.innerHTML = html;

      // 3. 为标签添加点击事件
      document.querySelectorAll('.tag-item').forEach(tagEl => {
        tagEl.addEventListener('click', () => {
          const selectedTag = tagEl.dataset.tag;
          
          // 更新激活状态
          document.querySelectorAll('.tag-item').forEach(el => {
            el.classList.remove('tag-active');
          });
          tagEl.classList.add('tag-active');

          // 设置当前激活标签、显示重置按钮
          activeTag = selectedTag;
          resetFilterBtn.classList.remove('hidden');

          // 重新渲染工具列表
          renderToolList();
        });
      });
    }

    // 生成工具列表（根据当前激活标签筛选）
    function renderToolList() {
      // 筛选工具（如果有激活标签则筛选，否则显示全部）
      const filteredTools = activeTag 
        ? toolsData.filter(tool => tool.tags.includes(activeTag))
        : toolsData;

      // 生成工具卡片HTML
      if (filteredTools.length === 0) {
        toolListEl.innerHTML = `
          <div class="col-span-full text-center py-10 text-gray-500">
            <i class="fa fa-search text-3xl mb-4"></i>
            <p>No tools found for this tag</p>
          </div>
        `;
        return;
      }

      let html = filteredTools.map(tool => {
        // 生成工具标签HTML
        const tagHtml = tool.tags.map(tag => `
          <span class="bg-gray-100 text-gray-600 px-2 py-0.5 rounded text-xs">
            ${tag}
          </span>
        `).join(' ');

        // 生成工具链接（按要求拼接：/free/detail/[file]）
        const toolLink = `/free/detail/${tool.file}`;

        return `
          <div class="tool-card">
            <div class="flex justify-between items-start mb-3">
              <h3 class="font-bold text-lg">
                <a href="${toolLink}" class="text-primary hover:underline" target="_blank">
                  ${tool.name}
                </a>
              </h3>
              <span class="bg-primary/10 text-primary text-xs px-2 py-1 rounded">
                #${tool.id}
              </span>
            </div>
            <div class="flex flex-wrap gap-1 mb-3">
              ${tagHtml}
            </div>
            <a href="${toolLink}" class="inline-flex items-center text-sm text-primary hover:text-primary/80" target="_blank">
              View Details <i class="fa fa-arrow-right ml-1"></i>
            </a>
          </div>
        `;
      }).join('');

      toolListEl.innerHTML = html;
    }

    // 重置筛选按钮事件
    resetFilterBtn.addEventListener('click', () => {
      // 清除激活标签状态
      activeTag = null;
      document.querySelectorAll('.tag-item').forEach(el => {
        el.classList.remove('tag-active');
      });

      // 隐藏重置按钮、重新渲染工具列表
      resetFilterBtn.classList.add('hidden');
      renderToolList();
    });

    // 页面加载完成后初始化
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>