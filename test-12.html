<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dev Tools Catalog</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome图标 -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 自定义Tailwind配置 -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            dark: {
              bg: '#121212',
              card: '#1E1E1E',
              border: '#333333',
              text: '#E0E0E0'
            },
            light: {
              bg: '#F8FAFC',
              card: '#FFFFFF',
              border: '#E2E8F0',
              text: '#1E293B'
            }
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .category-item {
        @apply py-2 px-4 cursor-pointer transition-all duration-200 hover:bg-primary/10 
               border-l-4 border-transparent hover:border-green-500/50;
      }
      .category-item-active {
        @apply bg-primary/10 border-primary font-medium;
      }
      .tag-item {
        @apply inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium cursor-pointer transition-all duration-200;
      }
      .tag-item-primary {
        @apply bg-primary/10 text-primary hover:bg-primary/20;
      }
      .sortable-header {
        @apply cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-border transition-colors;
      }
      .sort-indicator {
        @apply ml-1 text-xs opacity-70;
      }
      .table-row-hover {
        @apply hover:bg-primary/5 dark:hover:bg-primary/10 transition-colors duration-200;
      }
      .card-hover {
        @apply hover:shadow-md hover:border-primary/30 transition-all duration-200;
      }
      .theme-toggle {
        @apply p-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white 
               transition-colors duration-200 cursor-pointer focus:outline-none;
      }
    }
  </style>
</head>
<body class="font-inter bg-light-bg text-light-text dark:bg-dark-bg dark:text-dark-text min-h-screen flex flex-col transition-colors duration-300">
  <!-- Header -->
  <header class="bg-gradient-to-r from-primary/90 to-primary shadow-md">
    <div class="container mx-auto px-4 py-5">
      <div class="flex justify-between items-center">
        <h1 class="text-xl md:text-2xl font-bold text-white flex items-center">
          <a href="/" class="flex items-center hover:opacity-90 transition-opacity">
            <i class="fa fa-wrench mr-3 transform rotate-12"></i>
            Dev Tools Catalog
          </a>
        </h1>
        <!-- Theme toggle button -->
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme mode">
          <i id="light-icon" class="fa fa-moon-o" aria-hidden="true"></i>
          <i id="dark-icon" class="fa fa-sun-o hidden" aria-hidden="true"></i>
        </button>
      </div>
      <p class="text-blue-100 mt-1 text-sm max-w-lg">
        A comprehensive collection of modern developer tools, frameworks, and resources.
      </p>
    </div>
  </header>

  <!-- 主要内容区 -->
  <main class="flex-1 flex flex-col md:flex-row">
    <!-- Sidebar: Category navigation -->
    <aside class="bg-white dark:bg-dark-card w-full md:w-56 border-r border-light-border dark:border-dark-border p-3 transition-colors duration-300">
      <div class="p-2 border-b border-light-border dark:border-dark-border mb-2">
        <h2 class="font-bold text-gray-800 dark:text-gray-200 text-sm">Categories</h2>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="category-count">0 categories</p>
      </div>
      
      <nav id="categories-nav" class="divide-y divide-gray-100 dark:divide-dark-border text-sm">
        <!-- Categories generated by JS (including All Tools) -->
        <div class="flex justify-center p-4">
          <div class="w-6 h-6 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
        </div>
      </nav>
    </aside>

    <!-- 右侧内容区域 -->
    <div class="flex-1 p-4">
      <!-- Toolbar: search, result count, view switch -->
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3">
        <div class="flex items-center w-full sm:w-auto gap-3">
          <div class="relative w-full sm:w-64">
            <input type="text" id="search-input" 
                  class="w-full px-3 py-2 border border-light-border dark:border-dark-border bg-white dark:bg-dark-card rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-sm transition-all duration-200"
                  placeholder="Search tools...">
            <button id="clear-search" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors hidden">
              <i class="fa fa-times"></i>
            </button>
          </div>
          
          <!-- Result count -->
          <div class="text-sm text-gray-500 dark:text-gray-400 whitespace-nowrap">
            <span id="results-count">0</span> results
          </div>
        </div>
        
        <div class="flex items-center gap-2 bg-white dark:bg-dark-card border border-light-border dark:border-dark-border rounded-lg p-1">
          <button id="table-view-btn" class="px-3 py-1 rounded bg-primary text-white text-sm transition-all duration-200">
            <i class="fa fa-table mr-1"></i> Table
          </button>
          <button id="card-view-btn" class="px-3 py-1 rounded text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm transition-all duration-200">
            <i class="fa fa-th-large mr-1"></i> Card
          </button>
        </div>
      </div>
      
      <!-- 所有内容区域 -->
      <div id="all-content" class="bg-white dark:bg-dark-card rounded-lg shadow-sm overflow-hidden border border-light-border dark:border-dark-border transition-colors duration-300">
        <!-- 表格视图 -->
        <div id="table-view" class="overflow-x-auto">
          <table class="min-w-full divide-y divide-light-border dark:divide-dark-border">
            <thead class="bg-gray-50 dark:bg-gray-800">
              <tr>
                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider sortable-header" data-sort="name">
                  Name
                  <i class="fa fa-sort sort-indicator"></i>
                </th>
                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider sortable-header" data-sort="category">
                  Category
                  <i class="fa fa-sort sort-indicator"></i>
                </th>
                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider sortable-header" data-sort="tags">
                  Tags
                  <i class="fa fa-sort sort-indicator"></i>
                </th>
              </tr>
            </thead>
            <tbody id="tools-table-body" class="bg-white dark:bg-dark-card divide-y divide-light-border dark:divide-dark-border">
              <!-- 表格内容将通过JS动态生成 -->
            </tbody>
          </table>
        </div>
        
        <!-- 卡片视图 -->
        <div id="card-view" class="hidden p-4">
          <div id="tools-card-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3">
            <!-- 卡片内容将通过JS动态生成 -->
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-light-bg text-light-text py-4 mt-4 dark:bg-gray-900 dark:text-white">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-2 md:mb-0">
          <p class="font-bold text-sm">Dev Tools Catalog</p>
          <p class="text-gray-400 text-xs mt-1">A comprehensive developer tools collection</p>
        </div>
        <div class="flex space-x-3">
          <a href="#" class="text-gray-400 hover:text-primary transition-colors duration-200">
            <i class="fa fa-github"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-primary transition-colors duration-200">
            <i class="fa fa-twitter"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-primary transition-colors duration-200">
            <i class="fa fa-linkedin"></i>
          </a>
        </div>
      </div>
      <div class="border-t border-gray-200 dark:border-gray-700 mt-3 pt-3 text-center text-gray-400 text-xs">
        &copy; 2024 Dev Tools Catalog. All rights reserved.
      </div>
    </div>
  </footer>

  <!-- JavaScript 逻辑 -->
  <script>
    // 全局变量
    let toolsData = [];
    let filteredTools = [];
    let categories = {};
    let allTags = new Set();
    let activeCategory = 'all'; // 默认选中All Tools
    let currentView = 'table'; // 默认表格视图
    let sortConfig = {
      key: null,
      direction: 'asc' // 'asc' 或 'desc'
    };
    
    // DOM 元素
    const categoriesNav = document.getElementById('categories-nav');
    const categoryCount = document.getElementById('category-count');
    const searchInput = document.getElementById('search-input');
    const clearSearchBtn = document.getElementById('clear-search');
    const resultsCountEl = document.getElementById('results-count');
    const toolsTableBody = document.getElementById('tools-table-body');
    const toolsCardContainer = document.getElementById('tools-card-container');
    const tableView = document.getElementById('table-view');
    const cardView = document.getElementById('card-view');
    const tableViewBtn = document.getElementById('table-view-btn');
    const cardViewBtn = document.getElementById('card-view-btn');
    const themeToggle = document.getElementById('theme-toggle');
    const lightIcon = document.getElementById('light-icon');
    const darkIcon = document.getElementById('dark-icon');

    // Initialization function
    async function init() {
      try {
        // Check user's preferred theme mode
        checkPreferredTheme();
        
        // Load JSON data
        toolsData = await loadToolsData();
        filteredTools = [...toolsData];
        
        // Process data
        processData();
        
        // Render page (including All Tools in all categories)
        renderCategories();
        updateResultsCount();
        renderTools();
        
        // Update stats (category count does not include All Tools)
        categoryCount.textContent = `${Object.keys(categories).length} categories`;
        
        // Add sorting event listeners
        document.querySelectorAll('.sortable-header').forEach(header => {
          header.addEventListener('click', () => {
            const sortKey = header.dataset.sort;
            
            // Toggle direction if already sorted by this key
            if (sortConfig.key === sortKey) {
              sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
            } else {
              sortConfig.key = sortKey;
              sortConfig.direction = 'asc';
            }
            
            updateSortIndicators();
            sortTools();
            renderTools();
          });
        });
        
        // Theme toggle event
        themeToggle.addEventListener('click', toggleTheme);
        
      } catch (error) {
        categoriesNav.innerHTML = `
          <div class="p-4 text-center">
            <i class="fa fa-exclamation-circle text-red-500 text-xl mb-2"></i>
            <h3 class="text-sm font-semibold text-red-800 dark:text-red-400 mb-1">Data load error</h3>
            <p class="text-red-600 dark:text-red-300 text-xs">${error.message}</p>
          </div>
        `;
        console.error('Initialization error:', error);
      }
    }

    // 检查用户偏好的主题
    function checkPreferredTheme() {
      // 检查本地存储中的主题设置
      const savedTheme = localStorage.getItem('theme');
      
      if (savedTheme === 'dark') {
        enableDarkMode();
      } else if (savedTheme === 'light') {
        enableLightMode();
      } else {
        // 如果没有保存的设置，使用用户系统偏好
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          enableDarkMode();
        } else {
          enableLightMode();
        }
      }
    }

    // 启用浅色模式
    function enableLightMode() {
      document.documentElement.classList.remove('dark');
      lightIcon.style.display = 'inline-block';
      darkIcon.style.display = 'none';
      localStorage.setItem('theme', 'light');
    }

    // 启用深色模式
    function enableDarkMode() {
      document.documentElement.classList.add('dark');
      lightIcon.style.display = 'none';
      darkIcon.style.display = 'inline-block';
      localStorage.setItem('theme', 'dark');
    }

    // 切换主题
    function toggleTheme() {
      if (document.documentElement.classList.contains('dark')) {
        enableLightMode();
      } else {
        enableDarkMode();
      }
    }

    // 加载工具数据
    async function loadToolsData() {
      // 实际应用中应使用 fetch('tools.json')
      return [
        {"file":"react","name":"React","category":"Frontend","tags":["Framework","JavaScript","UI"]},
        {"file":"vue","name":"Vue","category":"Frontend","tags":["Framework","JavaScript"]},
        {"file":"svelte","name":"Svelte","category":"Frontend","tags":["Framework","JavaScript"]},
        {"file":"nextjs","name":"Nextjs","category":"Frontend","tags":["Framework","JavaScript","Fullstack"]},
        {"file":"flutter","name":"Flutter","category":"Frontend","tags":["Framework","Mobile Development","UI"]},
        {"file":"expo","name":"Expo","category":"Frontend","tags":["Mobile Development","Framework","JavaScript"]},
        {"file":"bootstrap","name":"Bootstrap","category":"Frontend","tags":["UI Framework","CSS"]},
        {"file":"tailwind","name":"Tailwind","category":"Frontend","tags":["UI Framework","CSS Tools"]},
        {"file":"layui","name":"Layui","category":"Frontend","tags":["UI Framework","CSS"]},
        {"file":"sass","name":"Sass","category":"Frontend","tags":["CSS Tools","Styling"]},
        {"file":"less","name":"Less","category":"Frontend","tags":["CSS Tools","Styling"]},
        {"file":"postcss","name":"PostCSS","category":"Frontend","tags":["CSS Tools","Build"]},
        {"file":"vite","name":"Vite","category":"Frontend","tags":["Build Tools","JavaScript"]},
        {"file":"jquery","name":"jQuery","category":"Frontend","tags":["JavaScript Library","DOM"]},
        {"file":"d3","name":"D3","category":"Frontend","tags":["JavaScript Library","Charts","Visualization"]},
        {"file":"mocha","name":"Mocha","category":"Testing","tags":["JavaScript","Unit Testing"]},
        {"file":"jest","name":"Jest","category":"Testing","tags":["JavaScript","Unit Testing"]},
        {"file":"vitest","name":"Vitest","category":"Testing","tags":["JavaScript","Unit Testing"]},
        {"file":"reqres","name":"Reqres","category":"Testing","tags":["Mock Data","API"]},
        {"file":"postman","name":"Postman","category":"Tools","tags":["API Testing","Collaboration"]},
        {"file":"swagger","name":"Swagger","category":"Tools","tags":["API Docs","Collaboration"]},
        {"file":"json-placeholder","name":"JSON Placeholder","category":"Tools","tags":["Mock Data","API"]},
        {"file":"mock-api","name":"Mock API","category":"Tools","tags":["Mock Data","API"]},
        {"file":"regex101","name":"Regex101","category":"Tools","tags":["Regex","Testing"]},
        {"file":"express","name":"Express","category":"Backend","tags":["Node.js Framework","API"]},
        {"file":"spring-boot","name":"Spring Boot","category":"Backend","tags":["Java Framework","API"]},
        {"file":"symfony","name":"Symfony","category":"Backend","tags":["PHP Framework","Web App"]},
        {"file":"laravel","name":"Laravel","category":"Backend","tags":["PHP Framework","Web App"]},
        {"file":"wordpress","name":"WordPress","category":"Backend","tags":["CMS","Website"]},
        {"file":"apache","name":"Apache","category":"Backend","tags":["Web Server","Deployment"]},
        {"file":"nginx","name":"Nginx","category":"Backend","tags":["Web Server","Deployment"]},
        {"file":"centos","name":"CentOS","category":"Backend","tags":["Linux Server","Operating System"]},
        {"file":"ubuntu","name":"Ubuntu","category":"Backend","tags":["Linux Server","Operating System"]},
        {"file":"linux","name":"Linux","category":"Backend","tags":["Operating System","Linux"]},
        {"file":"elasticsearch","name":"Elasticsearch","category":"Backend","tags":["Search Engine","Database"]},
        {"file":"firebase","name":"Firebase","category":"Backend","tags":["BaaS","Cloud Service","Database"]},
        {"file":"supabase","name":"Supabase","category":"Backend","tags":["BaaS","API","Database"]},
        {"file":"mysql","name":"MySQL","category":"Database","tags":["SQL","Backend"]},
        {"file":"postgresql","name":"PostgreSQL","category":"Database","tags":["SQL","Backend"]},
        {"file":"sqlite","name":"SQLite","category":"Database","tags":["SQL","Lightweight"]},
        {"file":"mongodb","name":"MongoDB","category":"Database","tags":["NoSQL","Backend"]},
        {"file":"redis","name":"Redis","category":"Database","tags":["Cache","NoSQL"]},
        {"file":"dbeaver","name":"DBeaver","category":"Database","tags":["Management Tool","Visualization"]},
        {"file":"grafana","name":"Grafana","category":"Monitoring","tags":["Visualization","DevOps"]},
        {"file":"prometheus","name":"Prometheus","category":"Monitoring","tags":["Data Collection","DevOps"]},
        {"file":"uptimerobot","name":"UptimeRobot","category":"Monitoring","tags":["DevOps","Uptime"]},
        {"file":"echarts","name":"ECharts","category":"Charts","tags":["Visualization","Frontend"]},
        {"file":"highcharts","name":"Highcharts","category":"Charts","tags":["Visualization","Frontend"]},
        {"file":"chart","name":"Chart","category":"Charts","tags":["Visualization","Frontend"]},
        {"file":"helm","name":"Helm","category":"DevOps","tags":["Container Deployment","Kubernetes"]},
        {"file":"docker","name":"Docker","category":"DevOps","tags":["Container Management","Deployment"]},
        {"file":"kubernetes","name":"Kubernetes","category":"DevOps","tags":["Container Orchestration","Deployment"]},
        {"file":"vercel","name":"Vercel","category":"DevOps","tags":["Cloud Deployment","Frontend"]},
        {"file":"netlify","name":"Netlify","category":"DevOps","tags":["Cloud Deployment","Frontend"]},
        {"file":"render","name":"Render","category":"DevOps","tags":["Cloud Deployment","Fullstack"]},
        {"file":"fly-io","name":"Fly.io","category":"DevOps","tags":["Cloud Deployment","App Hosting"]},
        {"file":"circlecl","name":"CircleCI","category":"DevOps","tags":["CI/CD","Automation"]},
        {"file":"cloudflare","name":"Cloudflare","category":"Networking","tags":["CDN","Security","DevOps"]},
        {"file":"cloudflare-warp","name":"Cloudflare Warp","category":"Networking","tags":["VPN","Security"]},
        {"file":"letsencrypt","name":"Let's Encrypt","category":"Security","tags":["Certificate Management","HTTPS"]},
        {"file":"figma","name":"Figma","category":"Design","tags":["UI","Collaboration","Prototyping"]},
        {"file":"canva","name":"Canva","category":"Design","tags":["UI","Graphics Tool"]},
        {"file":"lottiefiles","name":"LottieFiles","category":"Design","tags":["Animation","Assets"]},
        {"file":"unsplash","name":"Unsplash","category":"Design","tags":["Image Assets","Resources"]},
        {"file":"excalidraw","name":"Excalidraw","category":"Design","tags":["Drawing Tool","Collaboration"]},
        {"file":"notion","name":"Notion","category":"Collaboration","tags":["Notes","Docs","Team"]},
        {"file":"obsidian","name":"Obsidian","category":"Collaboration","tags":["Notes","Knowledge Management"]},
        {"file":"slack","name":"Slack","category":"Collaboration","tags":["Chat Tool","Team"]},
        {"file":"discord","name":"Discord","category":"Collaboration","tags":["Chat Tool","Team"]},
        {"file":"asana","name":"Asana","category":"Collaboration","tags":["Project Management","Team"]},
        {"file":"trello","name":"Trello","category":"Collaboration","tags":["Project Management","Team"]},
        {"file":"zoom","name":"Zoom","category":"Collaboration","tags":["Video Meeting","Multimedia"]},
        {"file":"github","name":"GitHub","category":"Collaboration","tags":["Version Control","Development"]},
        {"file":"bitbucket","name":"Bitbucket","category":"Collaboration","tags":["Version Control","Development"]},
        {"file":"freecodecamp","name":"FreeCodeCamp","category":"Learning","tags":["Coding Practice","Learning"]},
        {"file":"exercism","name":"Exercism","category":"Learning","tags":["Coding Practice","Learning"]},
        {"file":"leetcode","name":"LeetCode","category":"Learning","tags":["Algorithm Practice","Learning"]},
        {"file":"kaggle","name":"Kaggle","category":"Learning","tags":["Data Analysis","AI","Learning"]},
        {"file":"doubao","name":"Doubao","category":"Learning","tags":["Learning Resources","Learning"]},
        {"file":"runway","name":"Runway","category":"AI Tools","tags":["Video Generation","Multimedia"]},
        {"file":"whisper","name":"Whisper","category":"AI Tools","tags":["Speech Recognition","NLP"]},
        {"file":"pytorch","name":"PyTorch","category":"AI Tools","tags":["Framework","Machine Learning"]},
        {"file":"openai","name":"OpenAI","category":"AI Tools","tags":["API","NLP"]},
        {"file":"copilot","name":"Copilot","category":"AI Tools","tags":["Dev Assistance","Code Tools"]},
        {"file":"deepseek","name":"DeepSeek","category":"AI Tools","tags":["Search","Assistance"]},
        {"file":"gradio","name":"Gradio","category":"AI Tools","tags":["Web UI","Prototyping"]},
        {"file":"obs-studio","name":"OBS Studio","category":"Multimedia","tags":["Video Recording","Streaming"]},
        {"file":"unity","name":"Unity","category":"Multimedia","tags":["Game Development","3D"]},
        {"file":"vscode","name":"VSCode","category":"Dev Tools","tags":["IDE","Editor"]},
        {"file":"xcode","name":"Xcode","category":"Dev Tools","tags":["IDE","Mobile Development"]},
        {"file":"replit","name":"Replit","category":"Online Dev","tags":["IDE","Collaboration"]},
        {"file":"cursor","name":"Cursor","category":"Tools","tags":["Dev Assistance","AI Assistance"]},
        {"file":"grammarly","name":"Grammarly","category":"Tools","tags":["Writing Assistance","AI Assistance"]},
        {"file":"prettier","name":"Prettier","category":"Tools","tags":["Code Formatting","Dev Assistance"]},
        {"file":"eslint","name":"ESLint","category":"Tools","tags":["Code Linting","Dev Assistance"]},
        {"file":"npm","name":"NPM","category":"Tools","tags":["Package Manager","JavaScript"]},
        {"file":"pnpm","name":"PNPM","category":"Tools","tags":["Package Manager","JavaScript"]},
        {"file":"yarn","name":"Yarn","category":"Tools","tags":["Package Manager","JavaScript"]},
        {"file":"zapier","name":"Zapier","category":"Tools","tags":["Automation","Collaboration"]},
        {"file":"docusaurus","name":"Docusaurus","category":"Tools","tags":["Docs Generator","Static Site"]},
        {"file":"gmail","name":"Gmail","category":"Tools","tags":["Email","Collaboration"]},
        {"file":"freenom","name":"Freenom","category":"Tools","tags":["Domain Service","Website"]},
        {"file":"7-zip","name":"7-Zip","category":"Tools","tags":["Compression","File Management"]}
      ];
    }

    // Process data: organize by category and extract tags
    function processData() {
      // Clear categories and tags for re-init
      categories = {};
      allTags = new Set();
      toolsData.forEach(tool => {
        const { category } = tool;
        if (!categories[category]) {
          categories[category] = {
            tags: new Set(),
            tools: []
          };
        }
        categories[category].tools.push(tool);
        tool.tags.forEach(tag => {
          categories[category].tags.add(tag);
          allTags.add(tag);
        });
      });
    }

    // Render category navigation - including All Tools
    function renderCategories() {
      // Build category array: All Tools first, then others
      let allCategories = [
        { id: 'all', name: 'All Tools', count: toolsData.length }
      ];
      Object.keys(categories).sort().forEach(category => {
        allCategories.push({
          id: category,
          name: category,
          count: categories[category].tools.length
        });
      });
      // Generate HTML
      let html = '';
      allCategories.forEach(category => {
        html += `
          <div class="category-item" data-category="${category.id}" style="border-left-color: ${activeCategory === category.id ? '#10B981' : 'transparent'}">
            <div class="flex justify-between items-center">
              <span>${category.name}</span>
              <span class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs px-2 py-0.5 rounded-full">
                ${category.count}
              </span>
            </div>
          </div>
        `;
      });
      categoriesNav.innerHTML = html;
      // Set active class and border
      document.querySelectorAll('.category-item').forEach(item => {
        if(item.dataset.category === activeCategory){
          item.classList.add('category-item-active');
          item.style.borderLeftColor = '#10B981';
        } else {
          item.classList.remove('category-item-active');
          item.style.borderLeftColor = 'transparent';
        }
        item.addEventListener('mouseenter', () => {
          if(!item.classList.contains('category-item-active')) {
            item.style.borderLeftColor = '#10B981';
          }
        });
        item.addEventListener('mouseleave', () => {
          if(!item.classList.contains('category-item-active')) {
            item.style.borderLeftColor = 'transparent';
          }
        });
      });
      // Click event
      document.querySelectorAll('.category-item').forEach(el => {
        el.addEventListener('click', () => {
          activeCategory = el.dataset.category;
          renderCategories(); // Keep active style in sync
          filterByCategory(activeCategory);
          // Reset search
          searchInput.value = '';
          clearSearchBtn.classList.add('hidden');
        });
      });
    }

    // 按分类筛选工具
    function filterByCategory(category) {
      activeCategory = category;
      
      if (category === 'all') {
        filteredTools = [...toolsData];
      } else {
        filteredTools = categories[category].tools;
      }
      
      // 保持排序状态
      if (sortConfig.key) {
        sortTools();
      }
      
      updateResultsCount();
      renderTools();
    }

    // 按搜索词筛选工具
    function filterBySearch() {
      const searchTermValue = searchInput.value.toLowerCase().trim();
      
      // 显示/隐藏清空按钮
      if (searchTermValue) {
        clearSearchBtn.classList.remove('hidden');
      } else {
        clearSearchBtn.classList.add('hidden');
        // 搜索为空时根据当前分类筛选
        filterByCategory(activeCategory || 'all');
        return;
      }
      
      // 根据搜索词筛选
      filteredTools = toolsData.filter(tool => {
        // 如果有活跃分类，先匹配分类
        if (activeCategory && activeCategory !== 'all' && tool.category !== activeCategory) {
          return false;
        }
        
        // 匹配工具名称或标签
        return tool.name.toLowerCase().includes(searchTermValue) ||
               tool.tags.some(tag => tag.toLowerCase().includes(searchTermValue));
      });
      
      // 保持排序状态
      if (sortConfig.key) {
        sortTools();
      }
      
      updateResultsCount();
      renderTools();
    }

    // 更新结果计数显示
    function updateResultsCount() {
      resultsCountEl.textContent = filteredTools.length;
    }

    // 按当前配置排序工具
    function sortTools() {
      if (!sortConfig.key) return;
      
      filteredTools.sort((a, b) => {
        let valueA, valueB;
        
        // 根据排序键获取比较值
        switch (sortConfig.key) {
          case 'name':
            valueA = a.name.toLowerCase();
            valueB = b.name.toLowerCase();
            break;
          case 'category':
            valueA = a.category.toLowerCase();
            valueB = b.category.toLowerCase();
            break;
          case 'tags':
            // 按第一个标签排序
            valueA = a.tags.length > 0 ? a.tags[0].toLowerCase() : '';
            valueB = b.tags.length > 0 ? b.tags[0].toLowerCase() : '';
            break;
          default:
            return 0;
        }
        
        // 比较并应用排序方向
        if (valueA < valueB) return sortConfig.direction === 'asc' ? -1 : 1;
        if (valueA > valueB) return sortConfig.direction === 'asc' ? 1 : -1;
        return 0;
      });
    }

    // 更新排序指示器
    function updateSortIndicators() {
      // 重置所有指示器
      document.querySelectorAll('.sortable-header i').forEach(icon => {
        icon.className = 'fa fa-sort sort-indicator';
      });
      
      // 设置当前排序指示器
      if (sortConfig.key) {
        const header = document.querySelector(`.sortable-header[data-sort="${sortConfig.key}"] i`);
        if (header) {
          header.className = `fa fa-sort-${sortConfig.direction} sort-indicator`;
        }
      }
    }

    // 渲染工具列表（表格和卡片视图）
    function renderTools() {
      // 渲染表格视图
      renderTableView();
      
      // 渲染卡片视图
      renderCardView();
    }

    // Render table view
    function renderTableView() {
      if (filteredTools.length === 0) {
        toolsTableBody.innerHTML = `
          <tr>
            <td colspan="3" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
              No matching tools found
            </td>
          </tr>
        `;
        return;
      }
      toolsTableBody.innerHTML = filteredTools.map(tool => {
        const toolLink = `/free/detail/${tool.file}`;
        return `
          <tr class="table-row-hover">
            <td class="px-4 py-3 whitespace-nowrap">
              <a href="${toolLink}" class="text-primary hover:underline text-sm font-medium transition-colors duration-200" target="_blank">
                ${tool.name}
              </a>
            </td>
            <td class="px-4 py-3 whitespace-nowrap">
              <span class="category-item bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-xs" data-category="${tool.category}">
                ${tool.category}
              </span>
            </td>
            <td class="px-4 py-3">
              <div class="flex flex-wrap gap-1">
                ${tool.tags.map(tag => `
                  <span class="tag-item tag-item-primary" data-tag="${tag}">
                    ${tag}
                  </span>
                `).join('')}
              </div>
            </td>
          </tr>
        `;
      }).join('');
      // Category click event in table
      document.querySelectorAll('#tools-table-body .category-item').forEach(catEl => {
        catEl.addEventListener('click', () => {
          const category = catEl.dataset.category;
          filterByCategory(category);
        });
      });
      // Tag click event in table
      document.querySelectorAll('#tools-table-body .tag-item').forEach(tagEl => {
        tagEl.addEventListener('click', () => {
          const tag = tagEl.dataset.tag;
          filterByTag(tag);
        });
      });
    }

    // Render card view
    function renderCardView() {
      if (filteredTools.length === 0) {
        toolsCardContainer.innerHTML = `
          <div class="col-span-full bg-gray-50 dark:bg-gray-800 rounded-lg p-6 text-center">
            <i class="fa fa-search text-gray-300 dark:text-gray-600 text-2xl mb-2"></i>
            <p class="text-gray-500 dark:text-gray-400 text-sm">No matching tools found</p>
          </div>
        `;
        return;
      }
      toolsCardContainer.innerHTML = filteredTools.map(tool => {
        const toolLink = `/free/detail/${tool.file}`;
        return `
          <div class="bg-gray-50 dark:bg-gray-800 rounded-lg border border-light-border dark:border-dark-border shadow-sm p-3 card-hover">
            <h3 class="font-semibold text-base mb-2">
              <a href="${toolLink}" class="text-primary hover:underline transition-colors duration-200" target="_blank">
                ${tool.name}
              </a>
            </h3>
            <div class="flex flex-wrap gap-1 mb-2">
              ${tool.tags.map(tag => `
                <span class="tag-item tag-item-primary" data-tag="${tag}">
                  ${tag}
                </span>
              `).join('')}
            </div>
            <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
              <span class="category-item bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded" data-category="${tool.category}">
                ${tool.category}
              </span>
            </div>
          </div>
        `;
      }).join('');
      // Category click event in cards
      document.querySelectorAll('#tools-card-container .category-item').forEach(catEl => {
        catEl.addEventListener('click', () => {
          const category = catEl.dataset.category;
          filterByCategory(category);
        });
      });
      // Tag click event in cards
      document.querySelectorAll('#tools-card-container .tag-item').forEach(tagEl => {
        tagEl.addEventListener('click', () => {
          const tag = tagEl.dataset.tag;
          filterByTag(tag);
        });
      });
    }

    // 按标签筛选工具
    function filterByTag(tag) {
      filteredTools = toolsData.filter(tool => {
        // 如果有活跃分类，先匹配分类
        if (activeCategory && activeCategory !== 'all' && tool.category !== activeCategory) {
          return false;
        }
        
        return tool.tags.includes(tag);
      });
      
      // 保持排序状态
      if (sortConfig.key) {
        sortTools();
      }
      
      updateResultsCount();
      renderTools();
    }

    // 切换视图模式（表格/卡片）
    function switchView(viewType) {
      currentView = viewType;
      
      if (viewType === 'table') {
        tableView.classList.remove('hidden');
        cardView.classList.add('hidden');
        tableViewBtn.classList.add('bg-primary', 'text-white');
        tableViewBtn.classList.remove('text-gray-600', 'dark:text-gray-300', 'hover:bg-gray-100', 'dark:hover:bg-gray-700');
        cardViewBtn.classList.remove('bg-primary', 'text-white');
        cardViewBtn.classList.add('text-gray-600', 'dark:text-gray-300', 'hover:bg-gray-100', 'dark:hover:bg-gray-700');
      } else {
        tableView.classList.add('hidden');
        cardView.classList.remove('hidden');
        cardViewBtn.classList.add('bg-primary', 'text-white');
        cardViewBtn.classList.remove('text-gray-600', 'dark:text-gray-300', 'hover:bg-gray-100', 'dark:hover:bg-gray-700');
        tableViewBtn.classList.remove('bg-primary', 'text-white');
        tableViewBtn.classList.add('text-gray-600', 'dark:text-gray-300', 'hover:bg-gray-100', 'dark:hover:bg-gray-700');
      }
    }

    // 清空搜索
    function clearSearch() {
      searchInput.value = '';
      clearSearchBtn.classList.add('hidden');
      filterByCategory(activeCategory || 'all');
    }

    // 事件监听
    searchInput.addEventListener('input', filterBySearch);
    clearSearchBtn.addEventListener('click', clearSearch);
    tableViewBtn.addEventListener('click', () => switchView('table'));
    cardViewBtn.addEventListener('click', () => switchView('card'));

    // 页面加载完成后初始化
    window.addEventListener('DOMContentLoaded', init);
  </script>
  <script type="module" src="/main.js"></script>
</body>
</html>
    